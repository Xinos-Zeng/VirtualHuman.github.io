# 虚拟人类(VirtualHuman)项目设计方案

## 1. 项目背景

虚拟人类(VH)是一个通过Agent来模拟人体内的器官、组织、细胞、靶点四个层级的系统。当输入药物信息和患者信息时，VH的层级架构会自顶向下传递各个节点模拟出的信息，从而实现对药物在人体内作用过程的模拟。

## 2. 项目目标

1. 通过前端页面以直观的方式(人体图，Agent节点分布在器官上)可视化信息流动
2. 通过动态线条连接各节点，使用动态光点移动代表信息流动方向
3. 实现层级化界面展示：主界面显示人体+器官级节点，点击进入下一层级查看更详细信息
4. 各节点信息通过静态JSON文件提供，动态解析获取各层级Agent节点数量

### 2.1 各级Agent节点
1. 器官 - 包括肠道、肝脏、肾脏、心脏、CNS
2. 组织 - 无需具体命名，包括肠道组织、肝脏组织、肾脏组织、心脏组织、CNS组织
3. 细胞 - 无需具体命名，包括肠道细胞、肝脏细胞、肾脏细胞、心脏细胞、CNS细胞
4. 靶点 - 无需具体命名，例如肠道靶点1，肠道靶点2，...
在器官-组织-细胞层级间都是1对1关系，细胞-靶点为1对多关系。


### 2.2 模拟效果
1. 点击"开始模拟"后，信息从Agent节点自上而下流动，初始默认为灰色未激活状态，信息流入后变成绿色激活状态，节点本身产生信息后弹出一个消息气泡，并根据信息判断风险等级，高则变成红色、中则为橙色、低则为绿色。
2. 初始时没有信息流动的动画，点击"开始模拟"后，光点才开始自顶向下逐层添加流动动画
3. 模拟出有的节点未被激活的状态(其子节点也不会被激活)，未被激活则保持灰色
4. 当节点产生信息时才在InfoPanel中显示Agent输出，当节点被激活时才显示出其子节点和连线，初始时只有根节点(患者/药物信息)。
5. 模拟节点存在不同风险等级(低中高)。


## 3. 系统架构

### 3.1 前端架构

- **React** - 核心UI框架
- **React Router** - 实现层级化页面导航
- **D3.js/Three.js** - 实现复杂的人体可视化和动态连接线
- **Styled-components** - 组件样式管理
- **Context API** - 状态管理

### 3.2 数据结构设计

```json
{
  "patient": {
    "id": "P001",
    "name": "测试患者",
    "age": 45,
    "gender": "male",
    "weight": 70,
    "height": 175
  },
  "drug": {
    "id": "D001",
    "name": "测试药物",
    "dosage": 100,
    "unit": "mg"
  },
  "organs": [
    {
      "id": "O001",
      "name": "肝脏",
      "position": {"x": 120, "y": 200},
      "status": "normal",
      "agentData": {...},
      "tissues": [
        {
          "id": "T001",
          "name": "肝实质",
          "status": "affected",
          "agentData": {...},
          "cells": [
            {
              "id": "C001",
              "name": "肝细胞",
              "status": "processing",
              "agentData": {...},
              "targets": [
                {
                  "id": "TG001",
                  "name": "酶A",
                  "status": "inhibited",
                  "agentData": {...}
                }
              ]
            }
          ]
        }
      ]
    }
  ],
  "connections": [
    {
      "from": "O001",
      "to": "O002",
      "strength": 0.8,
      "direction": "bidirectional"
    }
  ]
}
```

## 4. 界面设计

### 4.1 主界面 - 人体与器官层级

- 中心区域展示人体轮廓图
- 器官节点以图标形式分布在对应位置
- 节点之间的连接线表示信息流动路径
- 动态光点沿连接线移动表示信息流动
- 右侧面板显示当前选中器官的详细信息
- 顶部控制栏可输入药物和患者信息

### 4.2 器官界面 - 组织层级

- 放大显示选中器官的详细结构
- 组织节点分布在器官内部
- 节点间连接线表示组织间信息流动
- 右侧面板显示组织详细信息
- 顶部导航栏可返回人体层级

### 4.3 组织界面 - 细胞层级

- 显示组织的微观结构
- 细胞节点分布其中
- 节点间连接表示细胞间信息传递
- 右侧面板显示细胞详细信息

### 4.4 细胞界面 - 靶点层级

- 显示细胞内部结构
- 靶点节点分布在细胞内
- 节点间连接表示分子间相互作用
- 右侧面板显示靶点详细信息

## 5. 交互设计

1. **层级导航**
   - 点击节点进入下一层级
   - 面包屑导航栏用于返回上层
   - 支持缩放和平移操作

2. **信息展示**
   - 悬停节点显示简要信息
   - 点击节点在右侧面板显示详细信息
   - 支持节点状态筛选和高亮

3. **动态效果**
   - 信息流动以光点动画表示

## 6. 技术实现要点

### 6.1 人体可视化

- 使用SVG或Canvas绘制人体轮廓
- 器官位置通过坐标系定位
- 支持缩放和平移操作

### 6.2 节点与连接线

- 节点使用SVG或HTML元素实现
- 连接线使用SVG path或Canvas绘制
- 光点动画使用requestAnimationFrame实现

### 6.3 层级导航

- 使用React Router管理不同层级的页面
- 使用URL参数记录当前查看的节点ID
- 维护导航历史以支持回退操作

### 6.4 数据管理

- 使用Context API管理全局状态
- 数据加载和解析在应用初始化时完成
- 支持按需加载不同层级的数据
